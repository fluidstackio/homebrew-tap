# This file was generated by GoReleaser. DO NOT EDIT.
cask "fluidctl" do
  module GitHubHelper
    def self.token
      require "utils/github"

      # Prefer environment variable if available
      github_token = ENV["HOMEBREW_TAP_GITHUB_TOKEN"]
      github_token ||= GitHub::API.credentials
      raise "Failed to retrieve github api token" if github_token.nil? || github_token.empty?

      github_token
    end

    def self.release_asset_url(tag, name)
      require "json"
      require "net/http"
      require "uri"

      resp = Net::HTTP.get(
        # Replace with your GitHub repository URL
        URI.parse("https://api.github.com/repos/fluidstackio/atlas/releases/tags/fluidctl-v#{tag}"),
        {
          "Accept" => "application/vnd.github+json",
          "Authorization" => "Bearer #{token}",
          "X-GitHub-Api-Version" => "2022-11-28"
        }
      )

      release = JSON.parse(resp)
      release["assets"].find { |asset| asset["name"] == name }["url"]
    end
  end

  name "fluidctl"
  desc ""
  homepage ""
  version "0.1.0"

  livecheck do
    skip "Auto-generated on release."
  end

  binary "fluidctl"

  on_macos do
    on_intel do
      url "#{GitHubHelper.release_asset_url("#{version}", "fluidctl_Darwin_x86_64.tar.gz")}"
      sha256 "dab0f4c73d9925ee5cd8ab7b4ebd8f7d2e146a8012915ba1003bcfe7d66c67e5"
    end
    on_arm do
      url "#{GitHubHelper.release_asset_url("#{version}", "fluidctl_Darwin_arm64.tar.gz")}"
      sha256 "05afb170655c8114d213091a9787d5a57bbc03bfb0ea038202fb477d00f64d31"
    end
  end

  on_linux do
    on_intel do
      url "#{GitHubHelper.release_asset_url("#{version}", "fluidctl_Linux_x86_64.tar.gz")}"
      sha256 "1743618addac22fb6541683e638cecc52911e422cff29f55bbe1eace970a6e94"
    end
    on_arm do
      url "#{GitHubHelper.release_asset_url("#{version}", "fluidctl_Linux_arm64.tar.gz")}"
      sha256 "7aca962993d7ec8716389dea251e849627d835444d45209f222a9d94ef072956"
    end
  end

  # No zap stanza required
end
